{"version":3,"file":"websocket-wnrQWROL.js","sources":["../../../.svelte-kit/adapter-node/chunks/websocket.js"],"sourcesContent":["import { w as writable, d as derived } from \"./index.js\";\nconst API_BASE = \"http://127.0.0.1:8000\";\nfunction createAuthStore() {\n  const { subscribe, set, update } = writable({\n    user: null,\n    token: null,\n    isAuthenticated: false\n  });\n  return {\n    subscribe,\n    login: async (email, password) => {\n      const formData = new FormData();\n      formData.append(\"username\", email);\n      formData.append(\"password\", password);\n      const response = await fetch(`${API_BASE}/api/auth/login`, {\n        method: \"POST\",\n        body: formData\n      });\n      if (!response.ok) {\n        throw new Error(\"Invalid credentials\");\n      }\n      const data = await response.json();\n      update((state) => ({\n        ...state,\n        token: data.access_token,\n        isAuthenticated: true\n      }));\n      const userResponse = await fetch(`${API_BASE}/api/auth/me`, {\n        headers: {\n          \"Authorization\": `Bearer ${data.access_token}`\n        }\n      });\n      const user = await userResponse.json();\n      update((state) => ({ ...state, user }));\n      return user;\n    },\n    logout: () => {\n      set({ user: null, token: null, isAuthenticated: false });\n    },\n    checkAuth: async () => {\n      return false;\n    }\n  };\n}\nconst auth = createAuthStore();\nfunction createTasksStore() {\n  const { subscribe, set, update } = writable([]);\n  let token = null;\n  auth.subscribe((state) => {\n    token = state.token;\n  });\n  const getHeaders = () => ({\n    \"Content-Type\": \"application/json\",\n    \"Authorization\": `Bearer ${token}`\n  });\n  return {\n    subscribe,\n    load: async (filters = {}) => {\n      const params = new URLSearchParams();\n      Object.entries(filters).forEach(([key, value]) => {\n        if (value) params.append(key, value);\n      });\n      const response = await fetch(`${API_BASE}/api/tasks/?${params}`, {\n        headers: getHeaders()\n      });\n      const tasks2 = await response.json();\n      set(tasks2);\n      return tasks2;\n    },\n    create: async (taskData) => {\n      const response = await fetch(`${API_BASE}/api/tasks/`, {\n        method: \"POST\",\n        headers: getHeaders(),\n        body: JSON.stringify(taskData)\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.detail || \"Ошибка создания задачи\");\n      }\n      const task = await response.json();\n      update((tasks2) => [...tasks2, task]);\n      return task;\n    },\n    updateTask: async (taskId, taskData) => {\n      const response = await fetch(`${API_BASE}/api/tasks/${taskId}`, {\n        method: \"PATCH\",\n        headers: getHeaders(),\n        body: JSON.stringify(taskData)\n      });\n      const task = await response.json();\n      update((tasks2) => tasks2.map((t) => t.id === taskId ? task : t));\n      return task;\n    },\n    changeStatus: async (taskId, status, comment = null, extra = {}) => {\n      const response = await fetch(`${API_BASE}/api/tasks/${taskId}/status`, {\n        method: \"PATCH\",\n        headers: getHeaders(),\n        body: JSON.stringify({ status, comment, ...extra })\n      });\n      if (!response.ok) {\n        const error = await response.json();\n        throw new Error(error.detail || \"Ошибка изменения статуса\");\n      }\n      const task = await response.json();\n      update((tasks2) => tasks2.map((t) => t.id === taskId ? task : t));\n      return task;\n    },\n    undo: async (taskId) => {\n      const response = await fetch(`${API_BASE}/api/tasks/${taskId}/undo`, {\n        method: \"POST\",\n        headers: getHeaders()\n      });\n      const task = await response.json();\n      update((tasks2) => tasks2.map((t) => t.id === taskId ? task : t));\n      return task;\n    },\n    take: async (taskId) => {\n      const response = await fetch(`${API_BASE}/api/tasks/${taskId}/take`, {\n        method: \"POST\",\n        headers: getHeaders()\n      });\n      const task = await response.json();\n      update((tasks2) => tasks2.map((t) => t.id === taskId ? task : t));\n      return task;\n    },\n    delete: async (taskId) => {\n      await fetch(`${API_BASE}/api/tasks/${taskId}`, {\n        method: \"DELETE\",\n        headers: getHeaders()\n      });\n      update((tasks2) => tasks2.filter((t) => t.id !== taskId));\n    }\n  };\n}\nconst tasks = createTasksStore();\nconst tasksByStatus = derived(tasks, ($tasks) => {\n  const grouped = {\n    new: [],\n    in_progress: [],\n    editor_review: [],\n    client_approval: [],\n    client_approved: [],\n    sent_to_media: [],\n    published: [],\n    postponed: []\n  };\n  $tasks.forEach((task) => {\n    if (grouped[task.status]) {\n      grouped[task.status].push(task);\n    }\n  });\n  const now = /* @__PURE__ */ new Date();\n  const threeDaysAgo = new Date(now.getTime() - 3 * 24 * 60 * 60 * 1e3);\n  Object.keys(grouped).forEach((status) => {\n    grouped[status].sort((a, b) => {\n      const aOverdue = new Date(a.status_changed_at) < threeDaysAgo;\n      const bOverdue = new Date(b.status_changed_at) < threeDaysAgo;\n      if (aOverdue && !bOverdue) return -1;\n      if (!aOverdue && bOverdue) return 1;\n      return new Date(a.status_changed_at) - new Date(b.status_changed_at);\n    });\n  });\n  return grouped;\n});\nfunction createWebSocketStore() {\n  const { subscribe, set, update } = writable({\n    connected: false,\n    reconnecting: false\n  });\n  const connect = () => {\n    return;\n  };\n  const disconnect = () => {\n  };\n  const send = (message) => {\n  };\n  return {\n    subscribe,\n    connect,\n    disconnect,\n    send\n  };\n}\ncreateWebSocketStore();\nexport {\n  API_BASE as A,\n  auth as a,\n  tasksByStatus as t\n};\n"],"names":[],"mappings":"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"}