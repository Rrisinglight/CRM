import{s as le,n as z,d as f,r as se,x as N,i as C,b as h,u as O,l as _,y as ae,g as L,c as b,e as I,m as P,j as M,h as y,k as ie,o as re,p as ne,a as A,f as B,t as R,B as Y}from"../chunks/DWTpI_9b.js";import{e as J}from"../chunks/CE5jpK0j.js";import{S as oe,i as ce}from"../chunks/00uyEj5u.js";import{a as fe}from"../chunks/Dqg9LriT.js";function K(n,e,t){const l=n.slice();return l[7]=e[t],l}function ue(n){let e,t,l,r='<tr><th class="text-left px-4 py-3 font-medium">Задача</th> <th class="text-left px-4 py-3 font-medium">Клиент</th> <th class="text-left px-4 py-3 font-medium">СМИ</th> <th class="text-left px-4 py-3 font-medium">Автор</th> <th class="text-left px-4 py-3 font-medium">Опубликовано</th></tr>',a,s,i=J(n[0]),o=[];for(let u=0;u<i.length;u+=1)o[u]=ee(K(n,i,u));return{c(){e=y("div"),t=y("table"),l=y("thead"),l.innerHTML=r,a=M(),s=y("tbody");for(let u=0;u<o.length;u+=1)o[u].c();this.h()},l(u){e=b(u,"DIV",{class:!0});var d=I(e);t=b(d,"TABLE",{class:!0});var c=I(t);l=b(c,"THEAD",{class:!0,"data-svelte-h":!0}),P(l)!=="svelte-9mxy3e"&&(l.innerHTML=r),a=L(c),s=b(c,"TBODY",{class:!0});var k=I(s);for(let g=0;g<o.length;g+=1)o[g].l(k);k.forEach(f),c.forEach(f),d.forEach(f),this.h()},h(){_(l,"class","bg-gray-100"),_(s,"class","divide-y divide-surface-700"),_(t,"class","w-full"),_(e,"class","bg-white rounded-lg overflow-hidden")},m(u,d){C(u,e,d),h(e,t),h(t,l),h(t,a),h(t,s);for(let c=0;c<o.length;c+=1)o[c]&&o[c].m(s,null)},p(u,d){if(d&1){i=J(u[0]);let c;for(c=0;c<i.length;c+=1){const k=K(u,i,c);o[c]?o[c].p(k,d):(o[c]=ee(k),o[c].c(),o[c].m(s,null))}for(;c<o.length;c+=1)o[c].d(1);o.length=i.length}},d(u){u&&f(e),ne(o,u)}}}function de(n){let e,t="Архив пуст";return{c(){e=y("div"),e.textContent=t,this.h()},l(l){e=b(l,"DIV",{class:!0,"data-svelte-h":!0}),P(e)!=="svelte-p7auvw"&&(e.textContent=t),this.h()},h(){_(e,"class","text-center py-20 text-gray-500")},m(l,r){C(l,e,r)},p:z,d(l){l&&f(e)}}}function he(n){let e,t='<div class="animate-spin w-8 h-8 border-4 border-primary-500 border-t-transparent rounded-full"></div>';return{c(){e=y("div"),e.innerHTML=t,this.h()},l(l){e=b(l,"DIV",{class:!0,"data-svelte-h":!0}),P(e)!=="svelte-zif7fd"&&(e.innerHTML=t),this.h()},h(){_(e,"class","flex justify-center py-20")},m(l,r){C(l,e,r)},p:z,d(l){l&&f(e)}}}function Q(n){let e,t=n[7].description+"",l;return{c(){e=y("div"),l=R(t),this.h()},l(r){e=b(r,"DIV",{class:!0});var a=I(e);l=B(a,t),a.forEach(f),this.h()},h(){_(e,"class","text-sm text-gray-500 truncate max-w-xs")},m(r,a){C(r,e,a),h(e,l)},p(r,a){a&1&&t!==(t=r[7].description+"")&&A(l,t)},d(r){r&&f(e)}}}function W(n){let e=n[7].client.first_name+"",t,l,r=n[7].client.last_name+"",a;return{c(){t=R(e),l=M(),a=R(r)},l(s){t=B(s,e),l=L(s),a=B(s,r)},m(s,i){C(s,t,i),C(s,l,i),C(s,a,i)},p(s,i){i&1&&e!==(e=s[7].client.first_name+"")&&A(t,e),i&1&&r!==(r=s[7].client.last_name+"")&&A(a,r)},d(s){s&&(f(t),f(l),f(a))}}}function X(n){let e,t,l=n[7].media.name+"",r,a=n[7].media.logo_url&&Z(n);return{c(){e=y("div"),a&&a.c(),t=M(),r=R(l),this.h()},l(s){e=b(s,"DIV",{class:!0});var i=I(e);a&&a.l(i),t=L(i),r=B(i,l),i.forEach(f),this.h()},h(){_(e,"class","flex items-center gap-2")},m(s,i){C(s,e,i),a&&a.m(e,null),h(e,t),h(e,r)},p(s,i){s[7].media.logo_url?a?a.p(s,i):(a=Z(s),a.c(),a.m(e,t)):a&&(a.d(1),a=null),i&1&&l!==(l=s[7].media.name+"")&&A(r,l)},d(s){s&&f(e),a&&a.d()}}}function Z(n){let e,t;return{c(){e=y("img"),this.h()},l(l){e=b(l,"IMG",{src:!0,alt:!0,class:!0}),this.h()},h(){Y(e.src,t=n[7].media.logo_url)||_(e,"src",t),_(e,"alt",""),_(e,"class","w-5 h-5 rounded")},m(l,r){C(l,e,r)},p(l,r){r&1&&!Y(e.src,t=l[7].media.logo_url)&&_(e,"src",t)},d(l){l&&f(e)}}}function $(n){let e=n[7].author.first_name+"",t,l,r=n[7].author.last_name+"",a;return{c(){t=R(e),l=M(),a=R(r)},l(s){t=B(s,e),l=L(s),a=B(s,r)},m(s,i){C(s,t,i),C(s,l,i),C(s,a,i)},p(s,i){i&1&&e!==(e=s[7].author.first_name+"")&&A(t,e),i&1&&r!==(r=s[7].author.last_name+"")&&A(a,r)},d(s){s&&(f(t),f(l),f(a))}}}function ee(n){let e,t,l,r=n[7].title+"",a,s,i,o,u,d,c,k,g,p,V=te(n[7].publication_date||n[7].status_changed_at)+"",H,j,D=n[7].description&&Q(n),E=n[7].client&&W(n),T=n[7].media&&X(n),w=n[7].author&&$(n);return{c(){e=y("tr"),t=y("td"),l=y("div"),a=R(r),s=M(),D&&D.c(),i=M(),o=y("td"),E&&E.c(),u=M(),d=y("td"),T&&T.c(),c=M(),k=y("td"),w&&w.c(),g=M(),p=y("td"),H=R(V),j=M(),this.h()},l(m){e=b(m,"TR",{class:!0});var v=I(e);t=b(v,"TD",{class:!0});var x=I(t);l=b(x,"DIV",{class:!0});var S=I(l);a=B(S,r),S.forEach(f),s=L(x),D&&D.l(x),x.forEach(f),i=L(v),o=b(v,"TD",{class:!0});var U=I(o);E&&E.l(U),U.forEach(f),u=L(v),d=b(v,"TD",{class:!0});var q=I(d);T&&T.l(q),q.forEach(f),c=L(v),k=b(v,"TD",{class:!0});var F=I(k);w&&w.l(F),F.forEach(f),g=L(v),p=b(v,"TD",{class:!0});var G=I(p);H=B(G,V),G.forEach(f),j=L(v),v.forEach(f),this.h()},h(){_(l,"class","font-medium"),_(t,"class","px-4 py-3"),_(o,"class","px-4 py-3"),_(d,"class","px-4 py-3"),_(k,"class","px-4 py-3"),_(p,"class","px-4 py-3 text-gray-500"),_(e,"class","hover:bg-surface-750 transition-colors")},m(m,v){C(m,e,v),h(e,t),h(t,l),h(l,a),h(t,s),D&&D.m(t,null),h(e,i),h(e,o),E&&E.m(o,null),h(e,u),h(e,d),T&&T.m(d,null),h(e,c),h(e,k),w&&w.m(k,null),h(e,g),h(e,p),h(p,H),h(e,j)},p(m,v){v&1&&r!==(r=m[7].title+"")&&A(a,r),m[7].description?D?D.p(m,v):(D=Q(m),D.c(),D.m(t,null)):D&&(D.d(1),D=null),m[7].client?E?E.p(m,v):(E=W(m),E.c(),E.m(o,null)):E&&(E.d(1),E=null),m[7].media?T?T.p(m,v):(T=X(m),T.c(),T.m(d,null)):T&&(T.d(1),T=null),m[7].author?w?w.p(m,v):(w=$(m),w.c(),w.m(k,null)):w&&(w.d(1),w=null),v&1&&V!==(V=te(m[7].publication_date||m[7].status_changed_at)+"")&&A(H,V)},d(m){m&&f(e),D&&D.d(),E&&E.d(),T&&T.d(),w&&w.d()}}}function _e(n){let e,t,l,r="Архив задач",a,s,i,o,u,d;function c(p,V){return p[1]?he:p[0].length===0?de:ue}let k=c(n),g=k(n);return{c(){e=M(),t=y("div"),l=y("h1"),l.textContent=r,a=M(),s=y("div"),i=y("input"),o=M(),g.c(),this.h()},l(p){ae("svelte-1oitcmz",document.head).forEach(f),e=L(p),t=b(p,"DIV",{class:!0});var H=I(t);l=b(H,"H1",{class:!0,"data-svelte-h":!0}),P(l)!=="svelte-984p9d"&&(l.textContent=r),a=L(H),s=b(H,"DIV",{class:!0});var j=I(s);i=b(j,"INPUT",{type:!0,placeholder:!0,class:!0}),j.forEach(f),o=L(H),g.l(H),H.forEach(f),this.h()},h(){document.title="Архив | CRM",_(l,"class","text-2xl font-bold mb-8"),_(i,"type","text"),_(i,"placeholder","Поиск по названию, описанию..."),_(i,"class","w-full px-4 py-3 bg-gray-100 border border-gray-300 rounded-lg focus:outline-none focus:border-primary-500"),_(s,"class","mb-6"),_(t,"class","p-8")},m(p,V){C(p,e,V),C(p,t,V),h(t,l),h(t,a),h(t,s),h(s,i),N(i,n[2]),h(t,o),g.m(t,null),u||(d=[O(i,"input",n[4]),O(i,"keyup",n[5])],u=!0)},p(p,[V]){V&4&&i.value!==p[2]&&N(i,p[2]),k===(k=c(p))&&g?g.p(p,V):(g.d(1),g=k(p),g&&(g.c(),g.m(t,null)))},i:z,o:z,d(p){p&&(f(e),f(t)),g.d(),u=!1,se(d)}}}function te(n){return n?new Date(n).toLocaleDateString("ru-RU"):""}function pe(n,e,t){let l;ie(n,fe,d=>t(6,l=d));let r=[],a=!0,s="";re(()=>{i()});async function i(){t(1,a=!0);try{const d=new URLSearchParams({status:"published"});s&&d.append("search",s);const c=await fetch(`/api/tasks/?${d}`,{headers:{Authorization:`Bearer ${l.token}`}});t(0,r=await c.json())}catch(d){console.error("Failed to load archive:",d)}t(1,a=!1)}function o(){s=this.value,t(2,s)}return[r,a,s,i,o,d=>d.key==="Enter"&&i()]}class ge extends oe{constructor(e){super(),ce(this,e,pe,_e,le,{})}}export{ge as component};
